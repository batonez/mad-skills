<!doctype html>
<html>
	<head>
		<title>Skill Tree</title>
		<meta charset='utf-8' />
	</head>
	<body>
		<canvas id='main-canvas'>Canvas failed to load. Are you sure that your browser is from this century?</canvas>
    <script src="geometry.js"></script>
		<script>
      function redraw()
      {
        ctx.clearRect(0, 0, 640, 480);
        
        for (var i in rects) {
          if (rects[i].hasOwnProperty("parents")) {
            var parents = rects[i].parents;
            
            for (var pKey = 0; pKey < parents.length; pKey++)
              drawArrowBetweenRects(ctx, rects[i], rects[parents[pKey]]);
          }
            
          drawRect(ctx, rects[i]);
          prev = i;
        }
        
        ctx.strokeStyle = "#000000";
        ctx.strokeRect(0, 0, 640, 480);
      }
    
			var canvas = document.getElementById("main-canvas"),
			    ctx    = canvas.getContext('2d');
			canvas.height = 480;
			canvas.width  = 640;
      
      var xhr = new XMLHttpRequest();
      xhr.open('GET', 'skills.json', false);
      xhr.send();

      if (xhr.status != 200) {
        alert( xhr.status + ': ' + xhr.statusText );
      } else {
        rects = JSON.parse(xhr.responseText);
      }
  
      var clickedRect = undefined;
      
      redraw();
      
      canvas.onmousedown = function(e) {
        var mouse = getMousePositionOnCanvas(canvas, e);
        for (var i in rects) {
          if (isPointInsideRect(rects[i], mouse.x, mouse.y)) {
            clickedRect = rects[i];
            break;
          }
        }
        
        if (throwCoin())
          clickedRect.value += 1;

        redraw();
      };

      canvas.onmouseup = function(e) {
        clickedRect = undefined;
      };
      
      canvas.onmousemove = function(e) {
        
      };
      
      function throwCoin(probabilityOfTrue = 0.5)
      {
        return (Math.random() < probabilityOfTrue);
      }
		</script>
	</body>
</html>

